<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-powered Recipe Recommender</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="logo d-flex align-items-center">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
                <p>HappyRoast</p>
            </div>
            <ul class="nav-links d-flex">
                <li><a href="/">Home</a></li>
                <li><a href="/storage">Storage</a></li>
                <li><a href="/nutrition">Recipe</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </header>
    <div class="container mt-5">
        <div id="search-section" class="mb-5">
            <div id="ingredient-list">
                <input type="text" class="ingredient-input form-control mb-2" placeholder="Enter an ingredient">
            </div>
            <button class="btn btn-secondary mb-3" onclick="addIngredientField()">Add Another Ingredient</button>

            <!-- Calorie Filter Dropdown -->
            <div class="mb-3">
                <label for="calories" class="form-label">Calories Target:</label>
                <select class="form-select" id="calories" name="calories" aria-label="Calories Target">
                    <option value="" selected>No Target</option>
                    <option value="1">Below 500 kcal</option>
                    <option value="2">Below 1000 kcal</option>
                    <option value="3">More than 2000 kcal</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="searchRecipes()">Search</button>
        </div>

        <div id="recipe-results" class="mt-4"></div>
    </div>

    <script>
        // Function to add new ingredient input fields
        function addIngredientField() {
            let ingredientList = document.getElementById('ingredient-list');
            let inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.className = 'ingredient-input form-control mb-2';
            inputField.placeholder = 'Enter another ingredient';
            ingredientList.appendChild(inputField);
        }

        function searchRecipes() {
            let ingredients = [];
            let ingredientInputs = document.getElementsByClassName('ingredient-input');

            // Collect all ingredient input values
            for (let input of ingredientInputs) {
                if (input.value.trim() !== "") {
                    ingredients.push(input.value.trim());
                }
            }

            let query = ingredients.join(', ');  // Join ingredients with commas
            let calories = document.getElementById('calories').value;

            fetch('/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'query=' + encodeURIComponent(query) + '&calories=' + calories
            })
            .then(response => response.json())
            .then(data => {
                let output = '<h2 class="mt-4">Recommended Recipes</h2>';
                data.forEach(recipe => {
                    output += `
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title">${recipe.Label}</h5>
                                <a href="${recipe.URL}" class="btn btn-primary" target="_blank">View Recipe</a>
                                <div class="progress mt-3">
                                    <div class="progress-bar" role="progressbar" style="width: ${parseFloat(recipe.Similarity)}%;" aria-valuenow="${parseFloat(recipe.Similarity)}" aria-valuemin="0" aria-valuemax="100">${recipe.Similarity}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                document.getElementById('recipe-results').innerHTML = output;
            });
        }
    </script>
</body>

</html>
